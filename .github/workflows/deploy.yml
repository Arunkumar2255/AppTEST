name: Deploy Application to GKE using Helm

on:
  push:
    branches:
      - main

jobs:
  deploy-gke:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository containing the application code
      - name: Check out Application Repository
        uses: actions/checkout@v3

      # Install Helm
      - name: Install Helm
        run: |
          curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash

      # Authenticate to Google Cloud
      - name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v2'
        with:
          credentials_json: '${{ secrets.GOOGLE_CREDENTIALS }}'
   
      - name: Install gke-gcloud-auth-plugin
        run: |
         curl -sSL https://github.com/google-gke/gke-gcloud-auth-plugin/releases/latest/download/gke-gcloud-auth-plugin-linux-amd64.tar.gz -o gke-gcloud-auth-plugin.tar.gz
         tar -xzvf gke-gcloud-auth-plugin.tar.gz -C /usr/local/bin
         rm gke-gcloud-auth-plugin.tar.gz







      # Set up GKE kubectl credentials
      - name: 'Configure GKE credentials'
        run: |
          gcloud container clusters get-credentials my-private-cluster --zone asia-east1-c --project gcp-poc-442512

      # Verify kubectl setup
      - name: 'Verify kubectl setup'
        run: kubectl get nodes

      


